---
title: "FIM technical methodology"
author: "Lorae Stojanovic"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(DiagrammeR)
library(DT)

```

## R Markdown

The purpose of this document is to explain, in depth, how the FIM works.

```{r flow_chart, echo=FALSE}
grViz("
digraph flowchart {
  node [fontname = Helvetica, shape = box]

  Start [label = 'Start']
  Data_Input [label = 'Data Input']
  Data_Cleaning [label = 'Data Cleaning']
  Analysis [label = 'Analysis']
  Report_Generation [label = 'Report Generation']
  End [label = 'End']

  Start -> Data_Input
  Data_Input -> Data_Cleaning
  Data_Cleaning -> Analysis
  Analysis -> Report_Generation
  Report_Generation -> End
}
")
```

## Step 0: Load prior data
I have no idea how this is done, and we will have to refactor this section in depth.

## Step 1: Input

The FIM has many inputs. But when we run the FIM, we typically take into account 23 main data series, which are found in the "forecast" section of the sheet.

!["An image of the 'forecast' page of the 'forecast.xlsx' workbook."](images/forecast_sheet.png)

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Create the data frame
data <- data.frame(
  Name = c(
    "Consumption Grants", "Investment Grants", "Federal Purchases (NIPA Consistent)",
    "State Purchases (NIPA Consistent)", "Non-ARP Subsidies + ARP Provider Relief and PPP",
    "ARP Subsidies less Provider Relief and PPP", "Federal UI", "State UI", "Federal Medicaid",
    "Total Medicaid", "Medicare", "Non-ARP Rebate Checks", "ARP Rebate Checks",
    "ARP Other Vulnerable", "ARP Other Direct Aid plus Provider Relief",
    "Other Federal Social Benefits (including all SNAP)", "State Social Benefits ex Medicaid",
    "Federal Non-Corporate Taxes", "State Non-Corporate Taxes", "Federal Corporate Taxes",
    "State Corporate Taxes", "Federal Student Loans", "Supply Side IRA"
  ),
  VariableName = c(
    "consumption_grants", "investment_grants", "federal_purchases",
    "state_purchases", "federal_subsidies", "federal_aid_to_small_businesses_arp",
    "federal_ui", "state_ui", "medicaid_grants", "medicaid", "medicare",
    "rebate_checks", "rebate_checks_arp", "federal_other_vulnerable_arp",
    "federal_other_direct_aid_arp", "federal_social_benefits", "state_social_benefits",
    "federal_non_corporate_taxes", "state_non_corporate_taxes", "federal_corporate_taxes",
    "state_corporate_taxes", "federal_student_loans", "supply_side_ira"
  )
)

# Create the interactive table
datatable(data, colnames = c("Name", "Variable Name"), caption = "FIM Project Variables", options = list(pageLength = 23))
```

## Step 2: Reals
After we import the variables we need, we get their real levels. For some reason, we get real levels on more than 23 variables. Here are the variables we get real levels from.

Actually, this step doesn't even matter. Right now, we don't use the real levels
at all.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load necessary libraries
library(DT)

# Create the data frame with _real variables
real_variables <- data.frame(
  Number = 1:32,
  VariableName = c(
    "federal_ui_real", "state_ui_real", "subsidies_real",
    "federal_subsidies_real", "state_subsidies_real", "health_outlays_real",
    "federal_health_outlays_real", "state_health_outlays_real", "social_benefits_real",
    "federal_social_benefits_real", "state_social_benefits_real", "corporate_taxes_real",
    "federal_corporate_taxes_real", "state_corporate_taxes_real", "non_corporate_taxes_real",
    "federal_non_corporate_taxes_real", "state_non_corporate_taxes_real", "rebate_checks_arp_real",
    "federal_other_direct_aid_arp_real", "federal_other_vulnerable_arp_real",
    "federal_aid_to_small_businesses_arp_real", "federal_student_loans_real", "supply_side_ira_real",
    "ui_real", "rebate_checks_real", "medicaid_real", "medicaid_grants_real",
    "medicare_real", "federal_purchases_real", "state_purchases_real",
    "consumption_grants_real", "investment_grants_real"
  )
)

# Create the interactive table showing all real variables
datatable(real_variables, colnames = c("Number", "Variable Name"), options = list(pageLength = 32))
```
